
{% macro create_dictionary(name) %}
create table if not exists {{ name }}(
  id smallserial primary key,
  name text unique not null
);
{% endmacro %}


{% macro fill_dictionary(dict, raw_table, field) %}
insert into {{ dict }} (name)
  select distinct trim(r.data->>'{{ field }}')
  from {{ raw_table }} r
  where
    not exists (select 1 from {{ dict }} d
      where trim(r.data->>'{{ field }}') = d.name
    );
{% endmacro %}
